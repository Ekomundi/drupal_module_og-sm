<?php
/**
 * @file
 * Tests for the og_sm_context module.
 */

/**
 * Tests about the node type settings.
 */
class OgSmPathautoTestCase extends OgSmWebTestCase {
  /**
   * {@inheritdoc}
   */
  public static function getInfo() {
    return array(
      'name' => t('Site Pathauto'),
      'description' => t('Tests Site Pathauto functionality.'),
      'group' => t('Organic Groups Site Manager'),
    );
  }

  /**
   * {@inheritdoc}
   */
  public function setUp() {
    // Enable required modules.
    $modules = array('og_sm_pathauto');
    parent::setUp($modules);
  }

  /**
   * Test the pathauto pattern alter hook.
   */
  public function testPathautoPatternAlter() {
    $site_type = $this->ogSmCreateGroupNodeType();
    og_sm_add_site_type($site_type);
    $site = $this->ogSmCreateGroup($site_type);

    $original = $pattern = '[node:site-path]';

    module_load_include('inc', 'og_sm_pathauto', 'og_sm_pathauto.pathauto');

    $context = array(
      'data' => array(
        'node' => $site,
        'og_sm_site_path' => 'group/%/%/admin/test',
      ),
      'module' => 'node',
    );
    og_sm_pathauto_pathauto_pattern_alter($pattern, $context);
    $this->assertEqual($pattern, $original);

    $context = array(
      'data' => array(
        'node' => $site,
        'og_sm_site_path' => 'group/%/%/admin/test',
      ),
      'module' => 'og_sm',
    );
    og_sm_pathauto_pathauto_pattern_alter($pattern, $context);
    $this->assertEqual('[node:site-path]/admin/test', $pattern);
  }

}
