<?php
/**
 * @file
 * Tests for the og_sm_comment module.
 */

/**
 * Tests the OG SM Comment Override functionality.
 */
class OgSmCommentOverrideTestCase extends DrupalUnitTestCase {
  /**
   * {@inheritdoc}
   */
  public static function getInfo() {
    return array(
      'name' => t('Site Comment : Override'),
      'description' => t('Tests the Site Comment override functionality.'),
      'group' => t('Organic Groups Site Manager'),
    );
  }

  /**
   * {@inheritdoc}
   */
  public function setUp() {
    parent::setUp();

    // Require classes under test.
    require_once __DIR__ . '/../src/OverrideConfig.php';
    require_once __DIR__ . '/../src/OverrideNode.php';
  }

  /**
   * Test OverrideConfig.
   */
  public function testOverrideConfig() {
    // Config without override.
    $override = new OgSmCommentOverrideConfig('2');
    $this->assertIdentical(2, $override->getGlobalComment(), 'Global config is casted to integer.');
    $this->assertFalse($override->hasSiteComment(), 'No site is set.');
    $this->assertNull($override->getSiteComment(), 'No site set = NULL.');
    $this->assertFalse($override->isOverridable(), 'By default not overridable');
    $this->assertFalse($override->hasDefaultComment(), 'No default is set.');
    $this->assertNull($override->getDefaultComment(), 'No default set = NULL.');

    // Config with override but without default value.
    $override = new OgSmCommentOverrideConfig(2, '1', TRUE);
    $this->assertTrue($override->hasSiteComment(), 'Site comment level is set.');
    $this->assertIdentical(1, $override->getSiteComment(), 'Site comment casted to integer.');
    $this->assertTrue($override->isOverridable(), 'Overridable is set.');
    $this->assertFalse($override->hasDefaultComment(), 'No default is set.');
    $this->assertNull($override->getDefaultComment(), 'No default set = NULL.');

    // Override without override but with default value.
    $override = new OgSmCommentOverrideConfig(2, 1, FALSE, 5);
    $this->assertFalse($override->isOverridable(), 'Not overridable.');
    $this->assertFalse($override->hasDefaultComment(), 'No default when not overridable.');
    $this->assertNull($override->getDefaultComment(), 'The default value is not stored.');

    // Config with override and default value.
    $override = new OgSmCommentOverrideConfig(2, 1, TRUE, '3');
    $this->assertTrue($override->hasDefaultComment(), 'A default value is set.');
    $this->assertIdentical(3, $override->getDefaultComment(), 'Default value is returned as integer.');
  }

  /**
   * Test OverrideNode.
   */
  public function testOverrideNode() {
    // Without overridden setting.
    $override = new OgSmCommentOverrideNode('1');
    $this->assertIdentical(1, $override->getNid(), 'Node ID is set as integer.');
    $this->assertFalse($override->isOverridden(), 'Not overridden if the comment value is not passed.');
    $this->assertNull($override->getComment(), 'Comment setting is by default = NULL.');

    // With overridden setting.
    $override = new OgSmCommentOverrideNode('2', '2');
    $this->assertTrue($override->isOverridden(), 'Overridden if the comment value is passed.');
    $this->assertIdentical(2, $override->getComment(), 'Comment setting is saved as an integer.');
  }

}
